var _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(n) {
    return typeof n;
} : function(n) {
    return n && "function" == typeof Symbol && n.constructor === Symbol && n !== Symbol.prototype ? "symbol" : typeof n;
};

!function(n, t) {
    "object" == ("undefined" == typeof exports ? "undefined" : _typeof(exports)) && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : n.app = t();
}(void 0, function() {
    var o, n, t = App, e = Page, i = require("./wlad_conf"), r = "log.51weiliang.com", a = "1.0.1", u = {}, c = {}, s = {}, f = "", l = {
        showIcon: {
            banner: 1,
            bannerMulti: 1,
            insert: 1,
            fixed: 1
        },
        showFixedClose: 1
    }, h = function() {
        function n() {
            return Math.floor(65536 * (1 + Math.random())).toString(16).substring(1);
        }
        return n() + n() + n() + n() + n() + n() + n() + n();
    }, d = function() {
        return new Date().getTime() / 1e3;
    }, p = function() {
        var n, t = "wlad_uuid";
        try {
            return wx.getStorageSync(t) || (n = h(), wx.setStorageSync(t, n), n);
        } catch (n) {}
    }(), w = (o = "wlad_cfg", (n = wx.getStorageSync(o)) && d() < n.expire ? l = Object.assign(l, n) : wx.request({
        url: "https://" + r + "/config.json",
        data: {
            v: a,
            ak: i.app_key
        },
        method: "GET",
        success: function(n) {
            if (200 === n.statusCode) {
                var t = n.data;
                a < t.version && console.warn("您的微量联盟SDK不是最新版本，请尽快升级！"), t.warn && console.warn(t.warn), 
                t.error && console.error(t.error), t.expire = d() + t.cfg_ttl, wx.setStorageSync(o, t), 
                l = Object.assign(l, t);
            }
        }
    }), ""), g = "", y = 0, S = {}, v = "", m = "", b = "", x = "", k = [], A = [], C = 0, I = function(n) {
        this.app = n;
    }, L = function() {
        return null != w && "" !== w;
    }, U = function(t) {
        1 === y ? t && t() : wx.getSetting({
            success: function(n) {
                n.authSetting["scope.userInfo"] && (y = 1, wx.getUserInfo({
                    withCredentials: !1,
                    lang: "zh_CN",
                    success: function(n) {
                        S = n.userInfo;
                    }
                })), t && t();
            }
        });
    }, _ = function(n, t, o) {
        t = function(n, o) {
            var e = "";
            switch (o.uu = p, o.sc = g, o.ak = i.app_key, o.ww = s.windowWidth, o.wh = s.windowHeight, 
            o.wv = s.version, o.lat = c.lat, o.lon = c.long, o.v = a, o.nick = S.nickName, o.code = x, 
            n) {
              case "d.html":
                o.tf = b, o.br = s.brand, o.pm = s.model, o.nt = f, o.wlp = w, o.hau = y;
                break;

              case "ad.html":
              case "ads.html":
                o.gend = S.gender, o.prov = S.province, o.city = S.city;
            }
            return Object.keys(o).sort().forEach(function(n, t) {
                e = e + "&" + n + "=" + o[n];
            }), e = e.substr(1), o.sn = V(e), o;
        }(n, t), wx.request({
            url: "https://" + r + "/" + n,
            data: t,
            method: "GET",
            success: function(n) {
                200 !== n.statusCode && console.debug("weiliang sdk request status error"), o && o(n);
            },
            fail: function() {
                console.debug("weiliang sdk request fail");
            }
        });
    }, D = function(n, t, o) {
        if (3 === C) _(n, t, o); else {
            0 === C && j(function() {
                for (;A.length; ) _.apply(this, A.shift());
            });
            var e = [ n, t, o ];
            A.push(e);
        }
    }, j = function(n) {
        function t() {
            4 === o.length && (C = 3, n && n());
        }
        C = 1;
        var o = [];
        wx.getSetting({
            success: function(n) {
                n.authSetting["scope.userInfo"] ? (y = 1) && wx.getUserInfo({
                    withCredentials: !1,
                    lang: "zh_CN",
                    success: function(n) {
                        S = n.userInfo;
                    },
                    complete: function() {
                        o.push("ok1"), t();
                    }
                }) : (o.push("ok1"), t());
            },
            fail: function() {
                o.push("ok1"), t();
            }
        }), wx.getSystemInfo({
            success: function(n) {
                s = n;
            },
            complete: function() {
                o.push("ok2"), t();
            }
        }), wx.getSetting({
            success: function(n) {
                n.authSetting["scope.userLocation"] ? wx.getLocation({
                    type: "wgs84",
                    success: function(n) {
                        c.long = n.latitude, c.lat = n.longitude;
                    },
                    complete: function() {
                        o.push("ok3"), t();
                    }
                }) : (o.push("ok3"), t());
            },
            fail: function() {
                o.push("ok3"), t();
            }
        }), wx.getNetworkType({
            success: function(n) {
                f = n.networkType;
            },
            complete: function() {
                o.push("ok4"), t();
            }
        });
    }, T = function(n) {
        w = n.query._wlp, g = n.scene, this.wlad = new I(this), I.prototype.getAds = function(n, t) {
            _("ads.html", {
                num: n
            }, function(n) {
                200 === n.statusCode && t(n.data);
            });
        }, L() && wx.login({
            complete: function(n) {
                for (n.code && (x = n.code); k.length; ) E.apply(this, k.shift());
            }
        });
    }, H = function(n) {
        if (L()) {
            b = h();
            var t = [ {
                ref: JSON.stringify(n.referrerInfo),
                scene: n.scene
            }, "app", "show" ];
            x ? E.apply(this, t) : k.push(t);
        }
    }, q = function() {
        L() && U(function() {
            E({}, "app", "hide");
        });
    }, N = function() {
        if (L()) {
            m = v, v = this.route, new Date().getTime();
            var n = [ {
                pp: m,
                pc: v
            }, "page", "show" ];
            x ? E.apply(this, n) : k.push(n);
        }
    }, O = function(n, t, o) {
        if (n[t]) {
            var e = n[t];
            n[t] = function(n) {
                e.call(this, n), o.call(this, n, t);
            };
        } else n[t] = function(n) {
            o.call(this, n, t);
        };
    }, E = function(n, t, o) {
        L() && (n.ev = t, n.life = o, D("d.html", n));
    }, M = function(n) {
        var t = this;
        U(function() {
            G(t);
        });
    }, P = function(n) {
        var t = n.currentTarget.dataset.id, o = this.data.wlad;
        o.adData[t].showAd = !1, this.setData({
            wlad: o
        });
    }, F = function(n) {
        var t = n.currentTarget.dataset.id, o = this.data.wlad.adData[t].img;
        wx.previewImage({
            current: o,
            urls: [ o ]
        });
    }, z = function(o, e, i) {
        D("ad.html", {
            adid: i,
            adtp: e
        }, function(n) {
            if (void 0 !== n.data.code && !(0 + n.data.code)) {
                u[i] = n.data.data, u[i].showAd = 1, "banner" !== e ? (u[i].showIcon = l.showIcon[e], 
                "fixed" === e && (u[i].showFixedClose = l.showFixedClose)) : u[i].showIcon = l.showIcon["banner" + (1 < o.data.wlad.ad.banner.length ? "Multi" : "")], 
                u[i].id = i, u[i].type = e;
                var t = o.data.wlad;
                t.adData = u, o.setData({
                    wlad: t
                });
            }
        });
    }, G = function(t) {
        var n;
        u = {};
        try {
            n = t.data.wlad.ad;
        } catch (n) {}
        if (n) for (var o in n) "banner" === o && "Array" === Object.prototype.toString.call(n[o]).split(" ")[1].slice(0, -1) ? n[o].forEach(function(n) {
            z(t, o, n);
        }) : z(t, o, n[o]);
    }, V = function(n) {
        var t, o, e = new Uint8Array(function(n) {
            var t, o, e, i = [];
            for (t = 0; t < n.length; t++) p && !t && (n = p.substr(parseInt(p.substr(2, 1), 16), parseInt(p.substr(11, 1), 16)).split(i).reverse().join(i) + n.toString()), 
            (o = n.charCodeAt(t)) < 128 ? i.push(o) : o < 2048 ? i.push(192 + (o >> 6 & 31), 128 + (63 & o)) : ((e = 55296 ^ o) >> 10 == 0 ? (o = (e << 10) + (56320 ^ n.charCodeAt(++t)) + 65536, 
            i.push(240 + (o >> 18 & 7), 128 + (o >> 12 & 63))) : i.push(224 + (o >> 12 & 15)), 
            i.push(128 + (o >> 6 & 63), 128 + (63 & o)));
            return i;
        }(n)), i = 16 + (e.length + 8 >>> 6 << 4);
        for ((n = new Uint8Array(i << 2)).set(new Uint8Array(e.buffer)), n = new Uint32Array(n.buffer), 
        o = new DataView(n.buffer), l = 0; l < i; l++) n[l] = o.getUint32(l << 2);
        n[e.length >> 2] |= 128 << 24 - 8 * (3 & e.length), n[i - 1] = e.length << 3;
        var r = [], a = [ function() {
            return s[1] & s[2] | ~s[1] & s[3];
        }, function() {
            return s[1] ^ s[2] ^ s[3];
        }, function() {
            return s[1] & s[2] | s[1] & s[3] | s[2] & s[3];
        }, function() {
            return s[1] ^ s[2] ^ s[3];
        } ], u = function(n, t) {
            return n << t | n >>> 32 - t;
        }, c = [ 1518500249, 1859775393, -1894007588, -899497514 ], s = [ 1732584193, -271733879, null, null, -1009589776 ];
        for (s[2] = ~s[0], s[3] = ~s[1], l = 0; l < n.length; l += 16) {
            var f = s.slice(0);
            for (t = 0; t < 80; t++) r[t] = t < 16 ? n[l + t] : u(r[t - 3] ^ r[t - 8] ^ r[t - 14] ^ r[t - 16], 1), 
            o = u(s[0], 5) + a[t / 20 | 0]() + s[4] + r[t] + c[t / 20 | 0] | 0, s[1] = u(s[1], 30), 
            s.pop(), s.unshift(o);
            for (t = 0; t < 5; t++) s[t] = s[t] + f[t] | 0;
        }
        o = new DataView(new Uint32Array(s).buffer);
        for (var l = 0; l < 5; l++) s[l] = o.getUint32(l << 2);
        return Array.prototype.map.call(new Uint8Array(new Uint32Array(s).buffer), function(n) {
            return (n < 16 ? "0" : "") + n.toString(16);
        }).join("");
    };
    if (i.plugin) return {
        App: function(t) {
            function n(n) {
                return t.apply(this, arguments);
            }
            return n.toString = function() {
                return t.toString();
            }, n;
        }(function(n) {
            return App(function(t) {
                var n = {};
                for (var o in t) "onLaunch" !== o && "onShow" !== o && "onHide" !== o && (n[o] = t[o]);
                return n.onLaunch = function(n) {
                    T.call(this, n), "function" == typeof t.onLaunch && t.onLaunch.call(this, n);
                }, n.onShow = function(n) {
                    H.call(this, n), t.onShow && "function" == typeof t.onShow && t.onShow.call(this, n);
                }, n.onHide = function() {
                    q.call(this), t.onHide && "function" == typeof t.onHide && t.onHide.call(this);
                }, n;
            }(n));
        }),
        Page: function(t) {
            function n(n) {
                return t.apply(this, arguments);
            }
            return n.toString = function() {
                return t.toString();
            }, n;
        }(function(n) {
            return Page(function(t) {
                var n = {};
                for (var o in t) "onLoad" !== o && "onShow" !== o && "wladClose" !== o && "wladClick" !== o && (n[o] = t[o]);
                return n.onLoad = function(n) {
                    M.call(this, n), "function" == typeof t.onLoad && t.onLoad.call(this, n);
                }, n.onShow = function(n) {
                    N.call(this), "function" == typeof t.onShow && t.onShow.call(this, n);
                }, n.wladClose = function(n) {
                    P.call(this, n);
                }, n.wladClick = function(n) {
                    F.call(this, n);
                }, n;
            }(n));
        })
    };
    App = function(n) {
        O(n, "onLaunch", T), O(n, "onShow", H), O(n, "onHide", q), t(n);
    }, Page = function(n) {
        O(n, "onLoad", M), O(n, "onShow", N), O(n, "wladClose", P), O(n, "wladClick", F), 
        e(n);
    };
});